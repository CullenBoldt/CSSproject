# selects the number of unique users in each subreddit and orders them
# output to 'unique_users.csv'

SELECT subreddit, COUNT(DISTINCT author) unique_users
FROM TABLE_QUERY([fh-bigquery:reddit_comments], "REGEXP_MATCH(table_id, '^2017_..$')")
WHERE subreddit IN ('wichita', 'kansas', 'Lawrence', 'NewMexico', 'SantaFe', 'Albuquerque', 'Indiana', 'indianapolis', 'bloomington', 'California', 'LosAngeles', 'sanfrancisco', 'sandiego', 'Sacramento', 'Arkansas', 'LittleRock', 'fayetteville', 'massachusetts', 'boston', 'WorcesterMA', 'chicago', 'illinois', 'SpringfieldIL', 'Omaha', 'Nebraska', 'lincoln', 'Maine', 'vermont', 'oregon', 'Portland', 'Eugene', 'wyoming', 'northdakota', 'Michigan', 'Detroit', 'lansing', 'Virginia', 'VirginiaBeach', 'norfolk', 'MorgantownWV', 'WestVirginia', 'Washington', 'Seattle', 'Spokane', 'mississippi', 'Nevada', 'LasVegas', 'vegas', 'Reno', 'Colorado', 'Denver', 'ColoradoSprings', 'Iowa', 'desmoines', 'ames', 'newhampshire', 'nyc', 'newyork', 'Buffalo', 'Ohio', 'Cleveland', 'Columbus', 'cincinnati', 'florida', 'Miami', 'orlando', 'tampa', 'jacksonville', 'providence', 'RhodeIsland', 'Delaware', 'WilmingtonDE', 'newhaven', 'hartford', 'Connecticut', 'SaltLakeCity', 'Utah', 'Montana', 'pittsburgh', 'pennsylvania', 'philadelphia', 'Louisville', 'Kentucky', 'lexington', 'sanantonio', 'houston', 'Dallas', 'Texas', 'Alabama', 'Birmingham', 'HuntsvilleAlabama', 'arizona', 'phoenix', 'Tucson', 'SouthDakota', 'Charleston', 'southcarolina', 'ColumbiYEAH', 'Louisiana', 'NewOrleans', 'batonrouge', 'shreveport', 'baltimore', 'maryland', 'minnesota', 'saintpaul', 'Minneapolis', 'duluth', 'Atlanta', 'Georgia', 'Augusta', 'Idaho', 'Boise', 'wisconsin', 'madisonwi', 'milwaukee', 'newjersey', 'Newark', 'jerseycity', 'oklahoma', 'okc', 'tulsa', 'missouri', 'springfieldMO', 'StLouis', 'kansascity', 'Tennessee', 'Knoxville', 'Chattanooga', 'NorthCarolina', 'Charlotte', 'raleigh’, ’Anxiety', 'SanctionedSuicide', 'SuicideWatch', 'addiction', 'depression','mentalhealth')
GROUP BY subreddit
ORDER BY unique_users Desc